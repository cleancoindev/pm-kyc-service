sudo: required
services:
- docker
install:
- docker build --target builder -t pm-kyc-service_builder .
script:
- docker run -e TRAVIS=$TRAVIS -e TRAVIS_JOB_ID=$TRAVIS_JOB_ID -ti pm-kyc-service_builder /bin/sh 
  -c "cd /go/src/github.com/gnosis/pm-kyc-service/ && go test tests/default_test.go -v"
after_success:
- |-
  # Create Docker image if branch master or develop and not on pull requests
  if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then
    docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD";

    echo "Pushing to Docker-hub version generated from branch $TRAVIS_BRANCH";

    if [ "$TRAVIS_BRANCH" == "master" ]; then
      echo "Pushing image staging...";
      docker tag pm-kyc-service gnosispm/pm-kyc-service:staging;
      docker push gnosispm/pm-kyc-service:staging;
    elif [ "$TRAVIS_BRANCH" == "develop" ]; then
      echo "Pushing image develop...";
      docker tag pm-kyc-service gnosispm/pm-kyc-service:develop;
      docker push gnosispm/pm-kyc-service:develop;
    fi
    echo "The image has been pushed";
  else
    echo "There's no need to push the image to Docker-hub";
  fi
env:
  global:
  - secure: ZCX+RQFGZze5K2fZL5U7WY07xq35HjuciLH7SpMIi5fhSpXl24aEbAoZzrzyDcGxub356oAH4ui7wsjf3rphe5pBH2DdUDk0hIgxo9i+2iTwnxfQZaye7eN9T3k0eIqXqdfJ5H85ofN41BEwkAYp2NLAUdDvF+Sx9Dd2ZlGZ5q+Kh6ih/yGQ2XvOI4Ia1O69L6TdagXGTua8Sw1ZWH9FUg5Fhy2h6JBjjT4O4r3VoBHo5ObyWdZcfnFo/CmLMU/PN6mQvixbJ+hcG5M9BvdaZjtbZlrDCR+OJIMdnktwrqzvU/9BoPKRwXWGLC+GMLPVJ+kc0GUEFluSgXaMOWXfDqVw80+NHDYsT0mWXQ8eHxbdV5nPo7kcsDF0xKKP97nTFttJ1CAlsX6/Z/Se8ayKVR+Veg//DpcmuzgSGcvWWqBTMLj7XrMRv5o6pKC8+JUgIsrx3u7mnFSuFLDdyZPAukztsAEAVhH/5q8AKYjMpAX7DgsvPU7rK4CmT8l6EeKr8Og2Icy9iD1cb/m0Qj0XB+xcT0ceDTItS0qGtKzP+Ubv2b3Dh0fdlHovqfHVdUNF3DNgWKbhk943toIHbVnxS4h/bgPwPpxAChiCkj7Hw72wukwCkvtfdSn5znVGb+/bD3mQCqXzvp7JpHxcs78dj0rzmPekVZBxk3mGeP1GvCI=
  - secure: bo+CLHJGCEc7jMt/pWPsQ9XZZjFSemPdHR6e8hPVmZ75EUspwrnPNmJ9ltBeBqg+2wzlXxd6oli9EcTAU5CQF9dqyBsmbdOG+SDm/L1PzABpZc+/x1hLQWspPZeRa6rWfk+R5VtD4ApSAJ4AzeNEbpSpLuV9pmrRkBbMOHryogumZ/rBoWoa8fext2C5DZtuVv5Qri1n1C/iwBZ6doqjw2hnfIVn16I2D/2jYdyeiaCggzLlA/QECJaUubS7WdQap1AVJfWxTXGh1KsbknxX8bHc+gGkcwrAI6r+FSvfdKCddli/4jfm2e6lNGaFChZlsvM3gVvIwdgskXtmXWO6eKbXMyQ4jXfh7YwWYtPTd48wfOb4aQsbnEOYwMtbXV+tYBvl5Wv2rh0lyj8FIlLaJDIBWK7WcXUqUW9VvdbS4EmfsTNmGA1s3yU4xQIgcH/rcSxZvqU9D2lQxnwKHxKXb5x2gY7CHL4LWG9VowMlXbFT1SVZXk6UYoH04gUWp9Y3Q3Z7gA+o+HgvC2wcLh5X3PcZKnKlaxtCY40+GrRMWI9TKt6uUqVtFFabzc2vwg7V2SIvimxtBCCNk40h8tzZzYAygeb7thVdv5Rs+C6bOo4g9gR5Dvo/LMROL4OqyBzIvxGaiGHapIz8MUHNG7BGAYmWOz6N5Koo9c8+9wbX7PU=
